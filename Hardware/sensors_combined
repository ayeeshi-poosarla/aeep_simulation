import serial
import time

def save_data(filename, data):
    """Save collected data to a file."""
    with open(filename, "a") as f:
        for line in data:
            f.write(line + "\n")

# Set up serial connections
ser = serial.Serial('/dev/ttyACM0', 9600, timeout=1)
arduino = serial.Serial('/dev/ttyACM1', 115200, timeout=1)
time.sleep(2)

collected_data = []  # List to store data
filename = "datafile.txt"

while True:
    read_serial = ser.readline().decode('utf-8', errors='ignore').strip()
    line = arduino.readline().decode('utf-8', errors='ignore').strip()
    
    if line:
        print(line)
        collected_data.append(line)

        # Check for "STOP" signal (ensuring no hidden whitespace issues)
        if "STOP" in line.strip():
            print("Stopping data collection.")
            break  # Exit the while loop

    if read_serial:
        print("Force: ", read_serial)  # Units in grams
        collected_data.append("Force: " + read_serial)

# Save collected data before exiting
save_data(filename, collected_data)
print(f"Data saved successfully to {filename}.")
